---
version: "3"

tasks:
  sync:
    desc: Sync flux-system with the Git Repository
    cmds:
      - flux reconcile source git flux-system
    silent: true

  reconcile:
    desc: Reconcile flux
    cmds:
      - flux reconcile kustomization --with-source flux-system
      - flux reconcile kustomization crds
      - flux reconcile kustomization core
      - flux reconcile kustomization apps
    silent: true

  show:
    desc: show status flux
    cmds:
      - echo "# LAST COMMIT"
      - git rev-parse --short HEAD
      - echo ''
      - echo "# HELMRELEASES"
      - flux get helmreleases -A
      - echo ''
      - echo "# KUSTOMIZATIONS"
      - flux get kustomizations
    silent: true
