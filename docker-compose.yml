---
version: '3'
services:
  homeassistant:
    image: homeassistant/home-assistant:stable
    volumes:
      - ./homeassistant:/config
    environment:
      - TZ=America/Paris
    restart: unless-stopped
    network_mode: host

  mosquitto:
    image: eclipse-mosquitto
    ports:
      - '1883:1883'
      - '9001:9001'
    volumes:
      - './mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf'

  icantbelieveitsnotvaletudo:
    image: rickardrockard/icantbelieveitsnotvaletudo:latest
    volumes:
      - './icantbelieveitsnotvaletudo/config.json:/app/config.json'

  influxdb:
    image: influxdb:2.0-alpine
    ports:
      - '8086:8086'
    volumes:
      - './influxdb/data:/var/lib/influxdb2'
      - './influxdb/config:/etc/influxdb2'
    environment:
      DOCKER_INFLUXDB_INIT_MODE: setup
      DOCKER_INFLUXDB_INIT_USERNAME: ${INFLUXDB_USERNAME}
      DOCKER_INFLUXDB_INIT_PASSWORD: ${INFLUXDB_PASSWORD}
      DOCKER_INFLUXDB_INIT_ORG: sillyhome
      DOCKER_INFLUXDB_INIT_BUCKET: sillyhome
      DOCKER_INFLUXDB_INIT_RETENTION: 1w
      DOCKER_INFLUXDB_INIT_ADMIN_TOKEN: ${INFLUXDB_TOKEN}

  telegraf:
    image: telegraf:alpine
    volumes:
      - './telegraf/telegraf.conf:/etc/telegraf/telegraf.conf:ro'
      - '/:/hostfs:ro'
      - '/var/run/docker.sock:/var/run/docker.sock'
    environment:
      HOST_ETC: /hostfs/etc
      HOST_PROC: /hostfs/proc
      HOST_SYS: /hostfs/sys
      HOST_VAR: /hostfs/var
      HOST_RUN: /hostfs/run
      HOST_MOUNT_PREFIX: /hostfs
      INFLUX_TOKEN: ${INFLUXDB_TOKEN}
