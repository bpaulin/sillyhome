---

- hosts: all
  tasks:
    - name: Install apps
      include_role:
        name: sh_apps
      loop_control:
        label: "{{ app.name }}"
        loop_var: app
      loop:
        - "{{ app_traefik }}"
        - "{{ app_adguard }}"
        - "{{ app_monitoring }}"
        - "{{ app_jackett }}"
        - "{{ app_transmission }}"
        - "{{ app_radarr }}"
        - "{{ app_sonarr }}"
        - "{{ app_bazarr }}"
        - "{{ app_jellyfin }}"

    # - name: "medias folders"
    #   file:
    #     path: "/home/kah/{{ item }}"
    #     owner: kah
    #     group: kah
    #     state: directory
    #     mode: '700'
    #   become: true
    #   loop:
    #     - medias/downloads/watch
    #     - medias/downloads/complete
    #     - medias/downloads/incomplete
    #     - medias/tv
    #     - medias/movies
    #     - config/jackett
    #     - config/radarr
    #     - config/sonarr
    #     - config/bazarr
    #     - config/transmission
    #     - config/jellyfin
    #   tags:
    #     - medias


    # - name: Public portal
    #   kubernetes.core.helm:
    #     name: homer
    #     chart_ref: k8s-at-home/homer
    #     release_namespace: homer-public
    #     create_namespace: true
    #     values:
    #       ingress:
    #         main:
    #           enabled: true
    #           annotations:
    #             traefik.ingress.kubernetes.io/router.entrypoints: websecure
    #           hosts:
    #             - host: "paulin.homes"
    #               paths:
    #                 - path: "/"
    #                   pathType: Prefix
    #       configmap:
    #         config:
    #           enabled: true
    #           data:
    #             config.yml: "{{ lookup('template', 'app/homer_public.yml') }}"
    #   tags:
    #     - public

    # - name: Private portal
    #   kubernetes.core.helm:
    #     name: homer
    #     chart_ref: k8s-at-home/homer
    #     release_namespace: homer
    #     create_namespace: true
    #     values:
    #       ingress:
    #         main:
    #           enabled: true
    #           annotations:
    #             traefik.ingress.kubernetes.io/router.entrypoints: web
    #           hosts:
    #             - host: "sillykube"
    #               paths:
    #                 - path: "/"
    #                   pathType: Prefix
    #       configmap:
    #         config:
    #           enabled: true
    #           data:
    #             config.yml: "{{ lookup('template', 'app/homer.yml') }}"
    #   tags:
    #     - private
    #     - portal
